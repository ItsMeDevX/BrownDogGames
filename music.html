<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Music — BrownDogGames</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="icon" href="/MainIcon.png" type="image/png">
</head>

<script>(function(s){s.dataset.zone='9353937',s.src='https://al5sm.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
  
<body>
  <style>
    /* Mobile-first: stack player + playlist */
    .music-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }

    /* Desktop: two columns */
    @media (min-width: 900px){
      .music-grid{
        grid-template-columns: 1.4fr .6fr;
        align-items:start;
      }
    }

    /* Buttons: wrap + thumb friendly */
    .btn-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn-row .btn{
      flex:1 1 120px;
      min-height:44px;
    }

    /* Player sizing */
    .player-frame{
      margin-top:14px;
      border-radius:14px;
      overflow:hidden;
      background: rgba(255,255,255,.04);
    }
    .player-frame .ratio{
      position:relative;
      padding-top:70%; /* taller on mobile */
    }
    @media (min-width: 900px){
      .player-frame .ratio{
        padding-top:56.25%; /* 16:9 on desktop */
      }
    }
    .player-frame iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
    }

    /* Playlist UX improvements */
    #trackList .btn{
      text-align:left;
      justify-content:flex-start;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    #trackList .btn.is-active{
      outline:2px solid rgba(255,255,255,.25);
      transform:translateY(-1px);
    }
  </style>

  <header class="nav">
    <div class="nav-inner">
      <a class="brand" href="index.html">
        <img src="MainIcon.png" alt="BrownDogGames logo" class="site-logo">
        <span>BrownDogGames</span>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="assets.html">Templates & Assets</a>
        <a href="support.html">Support</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1 class="h1">Music</h1>
    <p class="sub">Original tracks & loops I’ve made — press play and browse the playlist.</p>

    <div class="music-grid">
      <!-- PLAYER -->
      <section class="card">
        <div class="card-pad">
          <p class="card-title">Player</p>
          <p class="card-muted" id="nowPlaying">Loading a random track…</p>

          <div class="player-frame">
            <div class="ratio">
              <iframe
                id="drivePlayer"
                src=""
                allow="autoplay; fullscreen"
                allowfullscreen
                title="Google Drive player">
              </iframe>
            </div>
          </div>

          <div class="hr"></div>

          <div class="btn-row">
            <button class="btn" id="prevTrack" type="button">Previous</button>
            <button class="btn btn-primary" id="nextTrack" type="button">Next</button>

            <button class="btn" id="randomTrack" type="button">Random</button>
            <button class="btn" id="toggleShuffle" type="button">Shuffle: Off</button>
            <button class="btn" id="toggleRepeat" type="button">Repeat: Off</button>

            <button class="btn" id="openTrack" type="button">Open</button>
            <button class="btn" id="copyTrackLink" type="button">Copy Track Link</button>

            <button class="btn" id="sharePage" type="button">Share Page</button>
          </div>

          <div class="hr"></div>
          <p class="card-muted" style="font-size:.95em; margin:0;">
            Shortcuts: <strong>←</strong>/<strong>→</strong> prev/next, <strong>R</strong> random, <strong>S</strong> shuffle, <strong>L</strong> repeat.
          </p>
        </div>
      </section>

      <!-- PLAYLIST -->
      <aside class="card">
        <div class="card-pad">
          <p class="card-title">Playlist</p>
          <p class="card-muted">Click a track to load it in the player.</p>

          <div class="hr"></div>

          <div id="trackList" style="display:flex; flex-direction:column; gap:10px;"></div>

          <div class="hr"></div>
          <p class="card-muted" style="font-size:.95em;">
            Tip: For best playback, set each Drive file to
            <strong>“Anyone with the link can view.”</strong>
          </p>
        </div>
      </aside>
    </div>

    <footer class="footer">© <span id="y"></span> BrownDogGames</footer>
  </main>

  <script>
    // Footer year
    document.getElementById("y").textContent = new Date().getFullYear();

    // Share copies this page (edit if your filename differs)
    const MUSIC_PAGE_URL = "https://www.browndoggames.com/music.html";

    // Tracks (IDs only; share links not needed for playback)
    const tracks = [
      { title: "Track 01", id: "1yT-kPKwWHy5o4Y9I1LFjR_NCNa_LQ2Yv" },
      { title: "Track 02", id: "17t5GIbf_3bZ4tQ11O4JWVknrvgY3pH8M" },
      { title: "Track 03", id: "1Es6I_Mo8EUIDCEcXGebIVrlfxdOcwEIq" },
      { title: "Track 04", id: "1eK3WYhmaatS4KE4UFUcmN3tukxzh6OT3" },

      { title: "Track 05", id: "1oEeYgznLp_cEl8zyK31yo9p5H7hiJfwd" },
      { title: "Track 06", id: "1YiVKydAWzTKLRcQE84sQL_8iL2XzHsIo" },
      { title: "Track 07", id: "10VzBEzaO78JqYNPjQxburIHj9vFkdwEO" },
      { title: "Track 08", id: "1HbWFoojGLoxKDhZsBOK1pMydVT5OIJDU" },
      { title: "Track 09", id: "1yBMpgkrqMP4R0sQrcU6KOS59c0gdKl58" },
      { title: "Track 10", id: "1TpAOr9Pbx2GGvUbkETcnhb03whvPKzYp" },

      { title: "Track 11", id: "1RUeGlRos0b5wZx1ry_HMoPrvRB9peNjA" },
      { title: "Track 12", id: "1EAb2lAeHY94r9v0Vf5_ychPvKNa33OLe" },
      { title: "Track 13", id: "1GdMJpjgrsCzrk8fAwa3rs9dLnuzulRbF" },
      { title: "Track 14", id: "1dFdtYEoGjkK3J4dcL0Xve1ATYanI5eMP" },
      { title: "Track 15", id: "1v2KlPBCPQBt8abOhnsFaVoAOv3FFxzFG" },

      { title: "Track 16", id: "1rjiFNKtBimfOR7JzAM53DmI6-C3HFjjk" },
      { title: "Track 17", id: "1_MapxHLPQV5in7hwXxOA0ktCRnGp1ZGy" },
      { title: "Track 18", id: "1-b8c4r_MIySK-AwQz6N1e4LNCp2LcXJO" },
      { title: "Track 19", id: "1sXXWSCBo1btoANviXX4gxrKx_K8UFGSc" },
      { title: "Track 20", id: "1lv79S-tepJ4W86xoKs_yUfae6Ce57kp-" },

      { title: "Track 21", id: "1NviNa9rRv5G6u8S-A4WosJi5U5AkhCto" },
      { title: "Track 22", id: "1pnMSIlrr-dr5TcFaIeyeNwQudDLNDKe2" },
      { title: "Track 23", id: "1WNPnwP7bhlFSpswdXECSJKSqaq7bmXrG" },
      { title: "Track 24", id: "1lwR1wZ5YWcSxKI3uInAy4k4sqFCojnK5" },
      { title: "Track 25", id: "1klEiWijhJvVSPB-Qd46ifwWUWMwpprvu" },

      { title: "Track 26", id: "13SJyfenLLbMDPWXXmOYJ89bTMOUMEoGu" },
      { title: "Track 27", id: "17RkvghgcST6GlzuCxBk5xckoXVI7K3g8" },
      { title: "Track 28", id: "1Ay0hnJQouYcBjjW0fcC0fVG-GqKp6AtU" },
      { title: "Track 29", id: "1bOr0czje3la0mcUvZa8gAgiijyrX6YEk" },
      { title: "Track 30", id: "1vleqwaGgBr-TOq_aU1rK0Rcr5sKiWKyD" },

      { title: "Track 31", id: "140ggCUYd8t4zFGlnHTyqnLm-MAPRojsk" },
      { title: "Track 32", id: "1Q-GGDbMRuukA_w7fYp0dt572DaSIFpwc" },
      { title: "Track 33", id: "161wJn6MMeAgoBURcG9lICdKu_gnyESXl" },
      { title: "Track 34", id: "1qZ6sJcxTFqIBQsL72WDRpedFGpCodVZ0" },
      { title: "Track 35", id: "1g9Lnqa3N3z0208Iwm71NUQqzygDd32HG" },

      { title: "Track 36", id: "1onBL8BylaOSp_0YwW6gSwi_uOmAL0OKU" },
      { title: "Track 37", id: "1xXn3M7le5TbfKFM8aMtieM9F1P9sdENp" },
      { title: "Track 38", id: "1tsZCfOljWUh0sPBALgyRmwVTuDi8Z58Y" },
      { title: "Track 39", id: "1VIkJVJ7E9s24r0UmI-PnhMOgLaO5iYKm" },
      { title: "Track 40", id: "1tLftc_tAjLK4DpurFC3VByif0e7_kqfX" },

      { title: "Track 41", id: "1tdx_ugWSNQSIqYFEQSBUvH1xXBmJEOmq" },
      { title: "Track 42", id: "1mXiqUz9_84IUxJAeJWzZ4z82TShI-3RF" },
      { title: "Track 43", id: "11M5SXovbbT8MG7mJtYTVcYpTRptTVaQi" },
      { title: "Track 44", id: "1ocLC_yCk1ANHumH7LGE3hGlyRdpKJofe" },
      { title: "Track 45", id: "1hH5Tf-78DEpWC5SgCUM8i4mRWbRsrc3i" }
    ];

    function previewUrl(fileId) {
      return "https://drive.google.com/file/d/" + fileId + "/preview";
    }
    function viewUrl(fileId) {
      return "https://drive.google.com/file/d/" + fileId + "/view";
    }

    const player = document.getElementById("drivePlayer");
    const nowPlaying = document.getElementById("nowPlaying");
    const list = document.getElementById("trackList");

    const prevBtn = document.getElementById("prevTrack");
    const nextBtn = document.getElementById("nextTrack");
    const shareBtn = document.getElementById("sharePage");

    const randomBtn = document.getElementById("randomTrack");
    const shuffleBtn = document.getElementById("toggleShuffle");
    const repeatBtn = document.getElementById("toggleRepeat");
    const openBtn = document.getElementById("openTrack");
    const copyTrackBtn = document.getElementById("copyTrackLink");

    // State
    let currentIndex = 0;

    // "Shuffle" affects what Next/Prev do.
    // If shuffle is ON we walk a shuffled "queue" (order).
    let shuffleOn = false;
    let playOrder = [];     // array of indices like [3, 10, 0, ...]
    let orderPos = 0;       // position inside playOrder

    // Repeat modes:
    // 0 = off, 1 = all, 2 = one
    let repeatMode = 0;

    // Persist settings (optional but nice)
    const LS_KEY = "bdg_music_settings_v1";

    function loadSettings() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        const s = JSON.parse(raw);
        if (typeof s.shuffleOn === "boolean") shuffleOn = s.shuffleOn;
        if (typeof s.repeatMode === "number") repeatMode = s.repeatMode;
      } catch (_) {}
    }
    function saveSettings() {
      try {
        localStorage.setItem(LS_KEY, JSON.stringify({ shuffleOn, repeatMode }));
      } catch (_) {}
    }

    function clampIndex(i) {
      if (i < 0) return tracks.length - 1;
      if (i >= tracks.length) return 0;
      return i;
    }

    function randInt(max) {
      return Math.floor(Math.random() * max);
    }

    function buildShuffledOrder(startIndex) {
      // Fisher-Yates shuffle of indices
      const arr = Array.from({ length: tracks.length }, (_, i) => i);
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
      }

      // Put startIndex at the front (so Next follows the rest randomly)
      const at = arr.indexOf(startIndex);
      if (at > 0) {
        arr.splice(at, 1);
        arr.unshift(startIndex);
      }
      playOrder = arr;
      orderPos = 0;
    }

    function updateModeButtons() {
      shuffleBtn.textContent = "Shuffle: " + (shuffleOn ? "On" : "Off");

      const repeatText = repeatMode === 0 ? "Off" : repeatMode === 1 ? "All" : "One";
      repeatBtn.textContent = "Repeat: " + repeatText;

      // mild visual cue using existing classes
      shuffleBtn.className = shuffleOn ? "btn btn-primary" : "btn";
      repeatBtn.className  = repeatMode !== 0 ? "btn btn-primary" : "btn";
    }

    function setActive(index, opts = {}) {
      // opts:
      // - fromUserClick: if true, keep shuffle queue but jump to that track (if shuffle is on)
      // - autoplay: true/false (Drive preview usually starts playback automatically if allowed)

      index = clampIndex(index);
      currentIndex = index;

      const current = tracks[currentIndex];
      player.src = previewUrl(current.id);
      nowPlaying.textContent = "Now playing: " + current.title;

      // Update "Open" link target
      openBtn.disabled = false;
      openBtn.dataset.href = viewUrl(current.id);

      // Highlight playlist button + scroll into view
      const buttons = list.querySelectorAll("button[data-track-btn='1']");
      buttons.forEach((b) => {
        const i = Number(b.dataset.index);
        if (i === currentIndex) {
          b.classList.add("is-active");
          b.className = "btn btn-primary is-active";
          // scroll into view gently
          b.scrollIntoView({ block: "nearest", behavior: "smooth" });
        } else {
          b.classList.remove("is-active");
          b.className = "btn";
        }
      });

      // If shuffle is ON and this wasn't just a "next/prev",
      // re-seed the shuffle order so next picks up randomly after this track.
      if (shuffleOn && opts.fromUserClick) {
        buildShuffledOrder(currentIndex);
      }
    }

    function playNext() {
      if (repeatMode === 2) {
        // Repeat One: reload same track (acts like replay)
        setActive(currentIndex);
        return;
      }

      if (shuffleOn) {
        // advance within shuffled order
        orderPos += 1;

        if (orderPos >= playOrder.length) {
          if (repeatMode === 1) {
            // Repeat All: reshuffle
            buildShuffledOrder(currentIndex);
            orderPos = 1; // move past current
          } else {
            // Repeat Off: wrap back to first item in this shuffle order
            orderPos = 0;
          }
        }

        const nextIndex = playOrder[orderPos];
        setActive(nextIndex);
        return;
      }

      // normal order
      const nextIndex = currentIndex + 1;
      if (nextIndex >= tracks.length) {
        if (repeatMode === 1) setActive(0);
        else setActive(tracks.length - 1); // stop at end-ish behavior
      } else {
        setActive(nextIndex);
      }
    }

    function playPrev() {
      if (repeatMode === 2) {
        setActive(currentIndex);
        return;
      }

      if (shuffleOn) {
        orderPos -= 1;
        if (orderPos < 0) {
          if (repeatMode === 1) {
            // Repeat All: go to end of current shuffle order
            orderPos = playOrder.length - 1;
          } else {
            orderPos = 0;
          }
        }
        const prevIndex = playOrder[orderPos];
        setActive(prevIndex);
        return;
      }

      // normal order
      const prevIndex = currentIndex - 1;
      if (prevIndex < 0) {
        if (repeatMode === 1) setActive(tracks.length - 1);
        else setActive(0);
      } else {
        setActive(prevIndex);
      }
    }

    function playRandom(notSame = true) {
      if (tracks.length <= 1) {
        setActive(0);
        return;
      }
      let idx = randInt(tracks.length);
      if (notSame) {
        let guard = 0;
        while (idx === currentIndex && guard < 20) {
          idx = randInt(tracks.length);
          guard++;
        }
      }
      setActive(idx, { fromUserClick: true });
    }

    function cycleRepeatMode() {
      repeatMode = (repeatMode + 1) % 3; // 0 -> 1 -> 2 -> 0
      updateModeButtons();
      saveSettings();
    }

    function toggleShuffle() {
      shuffleOn = !shuffleOn;
      if (shuffleOn) {
        buildShuffledOrder(currentIndex);
      }
      updateModeButtons();
      saveSettings();
    }

    async function copyTextWithFallback(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (e) {
        window.prompt("Copy this:", text);
        return false;
      }
    }

    // Build playlist
    tracks.forEach((t, i) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "btn";
      btn.textContent = t.title;
      btn.dataset.index = String(i);
      btn.dataset.trackBtn = "1";
      btn.title = t.title;

      btn.addEventListener("click", function () {
        setActive(i, { fromUserClick: true });
      });

      list.appendChild(btn);
    });

    // Controls
    prevBtn.addEventListener("click", playPrev);
    nextBtn.addEventListener("click", playNext);

    randomBtn.addEventListener("click", function () {
      playRandom(true);
    });

    shuffleBtn.addEventListener("click", toggleShuffle);
    repeatBtn.addEventListener("click", cycleRepeatMode);

    openBtn.addEventListener("click", function () {
      const href = openBtn.dataset.href;
      if (href) window.open(href, "_blank", "noopener,noreferrer");
    });

    copyTrackBtn.addEventListener("click", async function () {
      const url = viewUrl(tracks[currentIndex].id);
      const ok = await copyTextWithFallback(url);
      copyTrackBtn.textContent = ok ? "Copied!" : "Copy Track Link";
      setTimeout(() => (copyTrackBtn.textContent = "Copy Track Link"), 1200);
    });

    // Share page (copies website link)
    shareBtn.addEventListener("click", async function () {
      const ok = await copyTextWithFallback(MUSIC_PAGE_URL);
      shareBtn.textContent = ok ? "Link copied!" : "Share Page";
      setTimeout(function () {
        shareBtn.textContent = "Share Page";
      }, 1200);
    });

    // Keyboard shortcuts (ignore when typing in inputs)
    document.addEventListener("keydown", (e) => {
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      if (tag === "input" || tag === "textarea" || e.isComposing) return;

      // Prevent page scroll on space
      if (e.code === "Space") {
        e.preventDefault();
        playNext();
        return;
      }

      if (e.key === "ArrowRight") { playNext(); return; }
      if (e.key === "ArrowLeft") { playPrev(); return; }
      if (e.key === "r" || e.key === "R") { playRandom(true); return; }
      if (e.key === "s" || e.key === "S") { toggleShuffle(); return; }
      if (e.key === "l" || e.key === "L") { cycleRepeatMode(); return; }
    });

    // Optional: try to auto-advance when a track ends.
    // NOTE: Google Drive preview iframe doesn't reliably expose "ended" events due to cross-origin restrictions,
    // so this is a best-effort feature and may not fire in all browsers.
    // If you later switch to a real <audio> element, you can hook ended events properly.

    // Init
    loadSettings();
    updateModeButtons();

    // Start on a random track (as requested)
    // If shuffle is ON, build shuffle order around that random start
    const startIndex = randInt(tracks.length);
    currentIndex = startIndex;

    if (shuffleOn) buildShuffledOrder(startIndex);
    setActive(startIndex, { fromUserClick: true });
  </script>
</body>
</html>
