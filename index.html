<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BrownDogGames</title>
  <link rel="icon" href="https://raw.githubusercontent.com/ItsMeDevX/BrownDogGames/main/LogoDog.ico" type="image/x-icon">
</head>

 <meta name="description" content="Discover and play free games, watch videos, and explore art. Join the BrownDogGames community and support creators.">
 <meta name="keywords" content="free games, indie games, game community, discover games, videos, art, game platform, creators">
 <meta name="author" content="BrownDogGames">
 <meta property="og:title" content="BrownDogGames - Discover Games, Videos & Art">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1336090735244829"
crossorigin="anonymous"></script>
  
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrownDogGames - Adult Cartoon Games</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik+Mono+One&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Rubik Mono One', sans-serif;
      background: linear-gradient(135deg, #2c1b33, #191425);
      color: #fefefe;
      min-height: 100vh;
      padding: 20px;
      padding-top: 140px; /* Space for fixed taskbar */
      text-align: center;
    }

    /* Taskbar Styles */
    #taskbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      max-width: 1200px;
      margin: 15px auto;
      background: #2a243b;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 15px;
      z-index: 1000;
      user-select: none;
    }

    .taskbar-logo img {
      height: 80px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .taskbar-logo img:hover {
      transform: scale(1.1);
    }

    .taskbar-nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .taskbar-nav button {
      background: #ff69b4;
      color: #1e1b2e;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .taskbar-nav button:hover {
      background: #ff8edb;
    }

    .taskbar-nav button.vip-only {
      background: #666;
      color: #999;
      cursor: not-allowed;
      position: relative;
    }

    .taskbar-nav button.vip-only:hover::after {
      content: "VIP Only";
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .taskbar-search {
      display: flex;
      gap: 8px;
      position: relative;
    }

    .taskbar-search input {
      width: 180px;
      padding: 8px;
      border: none;
      border-radius: 6px;
      background: #3b3750;
      color: #fefefe;
      font-size: 0.9rem;
    }

    .taskbar-search button {
      background: #ff69b4;
      color: #1e1b2e;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }

    .taskbar-search button:hover {
      background: #ff8edb;
    }

    #suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #3b3750;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      display: none;
      flex-direction: column;
      z-index: 10;
      margin-top: 5px;
    }

    #suggestions-dropdown > div {
      padding: 8px 12px;
      cursor: pointer;
      color: #fefefe;
      transition: background 0.2s;
    }

    #suggestions-dropdown > div:hover {
      background: #ff69b4;
      color: #1e1b2e;
    }

    .taskbar-messages {
      position: relative;
    }

    .messages-button {
      background: #ff69b4;
      color: #1e1b2e;
      border: none;
      padding: 8px 16px;
      font-weight: bold;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s;
    }

    .messages-button:hover {
      background: #ff8edb;
      transform: scale(1.05);
    }

    .messages-button.has-unread {
      background: linear-gradient(45deg, #ff69b4, #ff1493);
      animation: pulse-glow 2s infinite;
    }

    .message-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(45deg, #ff4444, #ff6666);
      color: white;
      border-radius: 50%;
      min-width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      border: 2px solid #2a243b;
      animation: bounce-badge 1s infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(255, 105, 180, 0.5); }
      50% { box-shadow: 0 0 15px rgba(255, 105, 180, 0.8); }
    }

    @keyframes bounce-badge {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .message-preview-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: #2a243b;
      border: 2px solid #ff69b4;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      min-width: 300px;
      max-width: 380px;
      display: none;
      flex-direction: column;
      z-index: 1000;
      margin-top: 8px;
      max-height: 360px;
      overflow-y: auto;
    }

    .message-preview-dropdown.show {
      display: flex;
    }

    .message-preview-header {
      background: #3b3750;
      padding: 10px;
      border-bottom: 1px solid #ff69b4;
      color: #ff69b4;
      font-weight: bold;
      text-align: center;
    }

    .message-preview-item {
      padding: 10px;
      border-bottom: 1px solid #3b3750;
      cursor: pointer;
      display: flex;
      gap: 8px;
      transition: background 0.2s;
    }

    .message-preview-item:hover {
      background: #3b3750;
    }

    .message-preview-item.unread {
      background: linear-gradient(90deg, rgba(255, 105, 180, 0.1), transparent);
      border-left: 3px solid #ff69b4;
    }

    .message-preview-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #ff69b4;
      object-fit: cover;
    }

    .message-preview-content {
      flex: 1;
      overflow: hidden;
    }

    .message-preview-sender {
      color: #ff69b4;
      font-weight: bold;
      font-size: 0.85rem;
      display: flex;
      justify-content: space-between;
    }

    .message-preview-text {
      color: #fefefe;
      font-size: 0.8rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .message-preview-time {
      color: #999;
      font-size: 0.65rem;
    }

    .message-preview-footer {
      padding: 8px;
      background: #3b3750;
      border-top: 1px solid #ff69b4;
      text-align: center;
    }

    .message-preview-footer button {
      background: linear-gradient(45deg, #ff69b4, #ff8edb);
      color: #1e1b2e;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.8rem;
      transition: transform 0.2s;
    }

    .message-preview-footer button:hover {
      transform: scale(1.05);
    }

    .no-messages {
      color: #999;
      font-style: italic;
      padding: 15px;
      font-size: 0.85rem;
      text-align: center;
    }

    .taskbar-vip {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .taskbar-vip button {
      background: linear-gradient(45deg, #2ecc71, #27ae60);
      color: #1e1b2e;
      border: none;
      padding: 8px 16px;
      font-weight: bold;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .taskbar-vip button:hover {
      background: linear-gradient(45deg, #27ae60, #2ecc71);
    }

    .vip-status {
      color: #2ecc71;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .free-status {
      color: #3498db;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .taskbar-auth {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .taskbar-auth button {
      background: #ff69b4;
      color: #1e1b2e;
      border: none;
      padding: 8px 16px;
      font-weight: bold;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .taskbar-auth button:hover {
      background: #ff8edb;
    }

    #user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    #user-info img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 2px solid #ff69b4;
      object-fit: cover;
    }

    #user-info strong {
      background: #ff69b4;
      color: #1e1b2e;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    #user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: #3b3750;
      border: 2px solid #ff69b4;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      min-width: 140px;
      display: none;
      flex-direction: column;
      z-index: 1000;
      margin-top: 5px;
    }

    #user-dropdown button {
      background: none;
      border: none;
      color: #fefefe;
      padding: 10px 14px;
      text-align: left;
      font-weight: bold;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    #user-dropdown button:hover {
      background: #ff69b4;
      color: #1e1b2e;
    }

    /* Access Gate Styles */
    #access-choice-gate {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      z-index: 10000;
      padding: 15px;
      overflow-y: auto;
      color: #ff69b4;
    }

    #access-choice-gate.show {
      display: flex;
    }

    .choice-gate-content {
      background: #2a243b;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(255, 105, 180, 0.4);
      max-width: 760px;
      width: 90%;
      margin: 15px auto;
    }

    .access-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 25px 0;
    }

    .access-option {
      background: #3b3750;
      padding: 25px;
      border-radius: 10px;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
    }

    .access-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .access-option.vip {
      border-color: #2ecc71;
      background: linear-gradient(135deg, #2d4a3a, #3b4d42);
    }

    .access-option.vip:hover {
      border-color: #27ae60;
    }

    .access-option.free {
      border-color: #3498db;
      background: linear-gradient(135deg, #2c3e50, #34495e);
    }

    .access-option.free:hover {
      border-color: #2980b9;
    }

    .access-option h3 {
      font-size: 1.4rem;
      margin-bottom: 12px;
      color: #fefefe;
    }

    .access-option.vip h3 { color: #2ecc71; }
    .access-option.free h3 { color: #3498db; }

    .access-option .price {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 12px 0;
    }

    .access-option.vip .price { color: #2ecc71; }
    .access-option.free .price { color: #3498db; }

    .feature-list {
      list-style: none;
      text-align: left;
      margin: 15px 0;
    }

    .feature-list li {
      padding: 6px 0;
      color: #ffc0cb;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
    }

    .feature-list .icon {
      width: 18px;
      text-align: center;
    }

    .vip-only-features, .free-features {
      padding: 12px;
      border-radius: 8px;
      margin: 12px 0;
      font-size: 0.85rem;
    }

    .vip-only-features {
      background: #2d4a3a;
      border-left: 3px solid #2ecc71;
    }

    .free-features {
      background: #2c3e50;
      border-left: 3px solid #3498db;
    }

    .vip-process {
      display: none;
      margin-top: 25px;
    }

    .vip-step {
      background: #3b3750;
      padding: 15px;
      border-radius: 8px;
      margin: 12px 0;
      border: 2px solid #ff69b4;
    }

    .vip-step.completed {
      background: #2a4d3a;
      border-color: #2ecc71;
    }

    .vip-step h4 {
      color: #ff69b4;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .vip-step.completed h4 {
      color: #2ecc71;
    }

    #github-login-btn {
      background: #333;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      font-size: 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      margin: 8px 0;
    }

    #github-login-btn:hover {
      background: #555;
    }

    #github-login-btn:disabled {
      background: #666;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .login-status {
      color: #2ecc71;
      font-size: 0.85rem;
      margin-top: 8px;
      display: none;
    }

    .login-status.show {
      display: block;
    }

    #vip-paypal-container {
      margin: 15px 0;
    }

    .gate-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .gate-buttons button {
      background: #666;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      font-size: 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 140px;
    }

    .gate-buttons button:hover {
      background: #888;
    }

    #access-message {
      margin: 12px 0;
      padding: 10px;
      border-radius: 6px;
      display: none;
      font-size: 0.85rem;
    }

    .success-message {
      background: #2ecc71;
      color: white;
    }

    .error-message {
      background: #e74c3c;
      color: white;
    }

    .access-note {
      background: #3b3750;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border: 2px solid #ff69b4;
      color: #ffc0cb;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .access-note strong {
      color: #ff69b4;
    }

    @media (max-width: 900px) {
      #taskbar {
        max-width: 95%;
        flex-direction: column;
        padding: 15px;
        margin: 10px auto;
      }

      .taskbar-logo img {
        height: 70px;
      }

      .taskbar-nav {
        justify-content: center;
        gap: 8px;
      }

      .taskbar-search input {
        width: 160px;
      }

      .access-options {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .choice-gate-content {
        padding: 20px;
        margin: 10px;
      }

      .message-preview-dropdown {
        min-width: 260px;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
        padding-top: 120px;
      }

      .taskbar-logo img {
        height: 60px;
      }

      .choice-gate-content {
        padding: 15px;
      }

      .access-option {
        padding: 15px;
      }

      .access-option h3 {
        font-size: 1.2rem;
      }

      .access-option .price {
        font-size: 1.5rem;
      }

      .message-preview-dropdown {
        min-width: 240px;
      }
    }
  </style>
</head>
<body>
  <!-- Taskbar -->
  <div id="taskbar">
    <div class="taskbar-logo">
      <img 
        src="https://raw.githubusercontent.com/ItsMeDevX/BrownDogGames/main/BrownDogGamesLogo.png" 
        alt="BrownDogGames Logo"
        onclick="window.location.href='index.html'"
      >
    </div>
    <div class="taskbar-nav" id="taskbar-nav"></div>
    <div class="taskbar-search">
      <input type="text" id="game-search-input" placeholder="Search games..." />
      <button id="search-button">Search</button>
      <div id="suggestions-dropdown"></div>
    </div>
    <div class="taskbar-messages" id="taskbar-messages" style="display: none;">
      <button class="messages-button" id="messages-button">
        💬 Messages
        <span class="message-badge" id="message-badge" style="display: none;">0</span>
      </button>
      <div class="message-preview-dropdown" id="message-preview-dropdown">
        <div class="message-preview-header">Recent Messages</div>
        <div id="message-preview-list">
          <div class="no-messages">No new messages</div>
        </div>
        <div class="message-preview-footer">
          <button onclick="window.location.href='user-profiles.html'">View All Messages</button>
        </div>
      </div>
    </div>
    <div class="taskbar-vip" id="taskbar-vip"></div>
    <div class="taskbar-auth" id="taskbar-auth"></div>
  </div>

  <!-- Access Choice Gate -->
  <div id="access-choice-gate">
    <div class="choice-gate-content">
      <h2>🎮 Welcome to BrownDogGames</h2>
      <p>Choose your access level:</p>
      <div class="access-note">
        <strong>📌 Note:</strong> Anyone can post content, games, art, and videos to earn money! VIP membership unlocks exclusive community features and premium content sharing.
      </div>
      <div class="access-options">
        <div class="access-option vip" id="vip-option">
          <h3>⭐ VIP Access</h3>
          <div class="price">£2/month</div>
          <ul class="feature-list">
            <li><span class="icon">👑</span> Exclusive VIP Dashboard</li>
            <li><span class="icon">💬</span> VIP Member Messaging</li>
            <li><span class="icon">🎁</span> Exclusive Content Sharing</li>
            <li><span class="icon">💰</span> Earn from Playing Games</li>
            <li><span class="icon">📊</span> Advanced Statistics</li>
            <li><span class="icon">✨</span> Premium Content Creation</li>
            <li><span class="icon">🏆</span> Priority Support</li>
          </ul>
          <div class="vip-only-features">
            <strong>Premium Features:</strong> VIP dashboard, messaging, exclusive content, and premium community access.
          </div>
        </div>
        <div class="access-option free" id="free-option">
          <h3>🆓 Free Access</h3>
          <div class="price">Free</div>
          <ul class="feature-list">
            <li><span class="icon">🎮</span> Browse & Play Public Games</li>
            <li><span class="icon">👀</span> View User Profiles</li>
            <li><span class="icon">🖼️</span> Access Art & Videos</li>
            <li><span class="icon">📤</span> Post Your Content</li>
            <li><span class="icon">💰</span> Earn from Uploads</li>
            <li><span class="icon">🔍</span> Search Content</li>
          </ul>
          <div class="free-features">
            <strong>Free Features:</strong> Browse content, post creations, and earn money.
          </div>
        </div>
      </div>
      <div class="vip-process" id="vip-process">
        <div class="vip-step" id="login-step">
          <h4>Step 1: Create Account</h4>
          <p>Login with GitHub to start your VIP membership</p>
          <button id="github-login-btn">🔑 Login with GitHub</button>
          <div class="login-status" id="login-status">✅ Logged in!</div>
        </div>
        <div class="vip-step" id="payment-step" style="display: none;">
          <h4>Step 2: Subscribe to VIP</h4>
          <p>Unlock VIP features for £2/month!</p>
          <div id="vip-paypal-container"></div>
        </div>
      </div>
      <div id="access-message"></div>
      <div class="gate-buttons">
        <button id="back-to-options" style="display: none;">← Back</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://www.paypal.com/sdk/js?client-id=AYgrpkjHd7Ycq_8vUWm9nb3qigcwALSTbyMZ5o6LjMqjC1YscFwQ_1kDEMr7tm2D1xysfHSEiyhZ1pZl&vault=true&intent=subscription"></script>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabase = createClient(
      'https://fwslmbzfukriibnkpzou.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3c2xtYnpmdWtyaWlibmtwem91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4NTcxMDcsImV4cCI6MjA2NDQzMzEwN30.juWK3T16_-LGHPii7xLp92Tt5TAZKN3IcZVn6nR8cBA'
    );

    window.supabaseClient = supabase;

    let gateUser = null;
    let currentVIPStatus = false;
    let currentUser = null;
    let currentUsername = null;
    let isInitialized = false;
    let renderingInProgress = false;
    let messageUpdateInterval = null;

    const gamePages = [
      { title: 'Lapdance Dash', url: 'https://browndoggames.com/Lapdance-Dash.html' },
      { title: 'Naked Craft', url: 'https://browndoggames.com/naked-craft.html' },
      { title: 'Butt Blaster Arena', url: 'https://browndoggames.com/butt-blaster-arena.html' },
      { title: 'Streaker Run', url: 'https://browndoggames.com/streaker-run.html' },
      { title: 'Pet Penis Simulator', url: 'https://browndoggames.com/pet-penis-simulator.html' },
      { title: 'Naked Fang', url: 'https://browndoggames.com/naked-fang.html' },
      { title: 'Climax Clash', url: 'https://browndoggames.com/Climax-Clash.html' },
      { title: 'Shafted', url: 'https://browndoggames.com/Shafted.html' },
      { title: 'She Comes First', url: 'https://browndoggames.com/She-Comes-First.html' },
      { title: 'LustLab', url: 'https://browndoggames.com/LustLab.html' }
    ];

    function toggleDropdown(dropdown) {
      dropdown.style.display = dropdown.style.display === 'flex' ? 'none' : 'flex';
    }

    async function checkVIPStatus(userId) {
      if (!userId) return false;
      const localVIP = localStorage.getItem('vipAccess') === 'true';
      if (localVIP) return true;

      try {
        const { data: user, error } = await supabase
          .from('users')
          .select('is_vip')
          .eq('id', userId)
          .single();

        if (error) {
          console.error('Error checking VIP status:', error);
          return false;
        }

        if (user?.is_vip) {
          localStorage.setItem('vipAccess', 'true');
          return true;
        }
        return false;
      } catch (error) {
        console.error('Error in checkVIPStatus:', error);
        return false;
      }
    }

    function renderNav() {
      if (renderingInProgress) return;
      const taskbarNav = document.getElementById('taskbar-nav');
      if (!taskbarNav) return;

      taskbarNav.innerHTML = '';
      const navItems = [
        { text: 'User Games', url: 'user-games.html' },
        { text: 'User Video', url: 'user-videos.html' },
        { text: 'User Music', url: 'user-music.html' },
        { text: 'User Art', url: 'user-art.html' },
        { text: 'User Profiles', url: 'user-profiles.html', vipOnly: true }
      ];

      navItems.forEach(item => {
        const btn = document.createElement('button');
        btn.textContent = item.text;
        if (item.vipOnly && !currentVIPStatus) {
          btn.classList.add('vip-only');
        } else {
          btn.addEventListener('click', () => window.location.href = item.url);
        }
        taskbarNav.appendChild(btn);
      });
    }

    async function renderVip() {
      if (renderingInProgress) return;
      const taskbarVip = document.getElementById('taskbar-vip');
      if (!taskbarVip) return;

      taskbarVip.innerHTML = '';
      const hasVIPAccess = localStorage.getItem('vipAccess') === 'true';
      const hasFreeAccess = localStorage.getItem('freeAccess') === 'true';

      if (hasVIPAccess || currentVIPStatus) {
        taskbarVip.innerHTML = '<div class="vip-status">⭐ VIP Member</div>';
      } else if (hasFreeAccess) {
        taskbarVip.innerHTML = '<div class="free-status">🆓 Free Member</div>';
        const upgradeBtn = document.createElement('button');
        upgradeBtn.textContent = 'Upgrade to VIP';
        upgradeBtn.addEventListener('click', () => {
          const gate = document.getElementById('access-choice-gate');
          if (!gate) return;
          if (currentUser) {
            gateUser = currentUser;
            document.querySelector('.access-options').style.display = 'none';
            document.getElementById('vip-process').style.display = 'block';
            document.getElementById('back-to-options').style.display = 'inline-block';
            document.getElementById('login-step').classList.add('completed');
            document.getElementById('github-login-btn').style.display = 'none';
            document.getElementById('login-status').classList.add('show');
            document.getElementById('payment-step').style.display = 'block';
            setTimeout(() => initVIPPayPal(), 500);
          } else {
            gateUser = null;
            document.querySelector('.access-options').style.display = 'grid';
            document.getElementById('vip-process').style.display = 'none';
            document.getElementById('back-to-options').style.display = 'none';
          }
          gate.classList.add('show');
        });
        taskbarVip.appendChild(upgradeBtn);
      } else {
        taskbarVip.innerHTML = '<div style="color: #888; font-size: 0.8rem;">Choose Access Level</div>';
      }
    }

    async function renderAuth() {
      if (renderingInProgress) return;
      renderingInProgress = true;
      const taskbarAuth = document.getElementById('taskbar-auth');
      if (!taskbarAuth) return;

      try {
        taskbarAuth.innerHTML = '';
        const existingDropdown = document.getElementById('user-dropdown');
        if (existingDropdown) existingDropdown.remove();

        const { data: { session } } = await supabase.auth.getSession();

        if (session?.user) {
          currentUser = session.user;
          currentUsername = session.user.user_metadata?.user_name || 
                           session.user.user_metadata?.preferred_username || 
                           await getUsernameFromDB(session.user.id) || 
                           session.user.email;
          currentVIPStatus = await checkVIPStatus(session.user.id);

          window.currentUser = currentUser;
          window.currentUsername = currentUsername;

          const accessGate = document.getElementById('access-choice-gate');
          if (accessGate && accessGate.classList.contains('show') && !gateUser) {
            window.dispatchEvent(new CustomEvent('vip-user-logged-in', { detail: session.user }));
          }

          const { user_metadata } = session.user;
          const name = user_metadata.full_name || 'User';
          const avatar = user_metadata.avatar_url || '';

          const userInfo = document.createElement('div');
          userInfo.id = 'user-info';
          userInfo.innerHTML = `
            ${avatar ? `<img src="${avatar}" alt="${name}">` : ''}
            <strong title="Click for options">${name} <span>▾</span></strong>
          `;
          taskbarAuth.appendChild(userInfo);

          const dropdown = document.createElement('div');
          dropdown.id = 'user-dropdown';
          dropdown.innerHTML = `
            <button onclick="goToMyPage()">My Page</button>
            <button onclick="window.location.href='dashboard.html'">Dashboard</button>
            <button onclick="logout()">Logout</button>
          `;
          taskbarAuth.appendChild(dropdown);
          userInfo.addEventListener('click', () => toggleDropdown(dropdown));

          updateMessageNotifications();
          if (messageUpdateInterval) clearInterval(messageUpdateInterval);
          messageUpdateInterval = setInterval(updateMessageNotifications, 30000);
        } else {
          currentUser = null;
          currentUsername = null;
          currentVIPStatus = false;
          window.currentUser = null;
          window.currentUsername = null;
          if (messageUpdateInterval) clearInterval(messageUpdateInterval);
          messageUpdateInterval = null;
          document.getElementById('taskbar-messages').style.display = 'none';
          taskbarAuth.innerHTML = '<button onclick="supabase.auth.signInWithOAuth({ provider: \'github\' })">Login with GitHub</button>';
        }
      } catch (error) {
        console.error('Error in renderAuth:', error);
      } finally {
        renderingInProgress = false;
      }
    }

    async function getUsernameFromDB(userId) {
      try {
        const { data } = await supabase
          .from('game_submissions')
          .select('github_user')
          .eq('user_id', userId)
          .limit(1);
        return data?.[0]?.github_user || null;
      } catch (error) {
        console.error('Error fetching username:', error);
        return null;
      }
    }

    window.goToMyPage = async () => {
      const dropdown = document.getElementById('user-dropdown');
      if (dropdown) dropdown.style.display = 'none';
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        const { data } = await supabase
          .from('game_submissions')
          .select('id')
          .eq('user_id', user.id)
          .limit(1);
        window.location.href = data?.length && currentUsername 
          ? `user.html?user=${currentUsername}` 
          : 'dashboard.html';
      } catch (error) {
        console.error('Error in goToMyPage:', error);
      }
    };

    window.logout = async () => {
      try {
        if (messageUpdateInterval) clearInterval(messageUpdateInterval);
        await supabase.auth.signOut();
        localStorage.removeItem('vipAccess');
        localStorage.removeItem('freeAccess');
        localStorage.removeItem('vipSubscriptionId');
        localStorage.removeItem('vipActivatedAt');
        currentUser = null;
        currentUsername = null;
        currentVIPStatus = false;
        window.currentUser = null;
        window.currentUsername = null;
        document.getElementById('taskbar-messages').style.display = 'none';
        document.getElementById('access-choice-gate').classList.add('show');
        window.location.reload();
      } catch (error) {
        console.error('Error during logout:', error);
      }
    };

    function initMessageNotifications() {
      const messagesButton = document.getElementById('messages-button');
      const messagePreviewDropdown = document.getElementById('message-preview-dropdown');
      if (!messagesButton || !messagePreviewDropdown) return;

      messagesButton.addEventListener('click', (e) => {
        e.stopPropagation();
        messagePreviewDropdown.classList.toggle('show');
        if (messagePreviewDropdown.classList.contains('show')) {
          loadMessagePreviews();
        }
      });

      document.addEventListener('click', (e) => {
        if (!messagePreviewDropdown.contains(e.target) && !messagesButton.contains(e.target)) {
          messagePreviewDropdown.classList.remove('show');
        }
      });
    }

    async function loadMessagePreviews() {
      const messagePreviewList = document.getElementById('message-preview-list');
      if (!window.supabaseClient || !currentUser || !currentUsername) {
        messagePreviewList.innerHTML = '<div class="no-messages">Please log in to see messages</div>';
        return;
      }

      try {
        const { data: messages, error } = await supabase
          .from('direct_messages')
          .select('*')
          .eq('recipient_username', currentUsername)
          .eq('is_read', false)
          .order('created_at', { ascending: false })
          .limit(5);

        if (error) {
          messagePreviewList.innerHTML = '<div class="no-messages">Error loading messages</div>';
          return;
        }

        if (!messages?.length) {
          messagePreviewList.innerHTML = '<div class="no-messages">No new messages</div>';
          return;
        }

        const senderMap = new Map();
        messages.forEach(msg => senderMap.set(msg.sender_username, msg));
        const uniqueMessages = Array.from(senderMap.values());

        messagePreviewList.innerHTML = await Promise.all(uniqueMessages.map(async msg => {
          const avatar = await getAvatarForUsername(msg.sender_username);
          const time = new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          const preview = msg.message_content.substring(0, 50) + (msg.message_content.length > 50 ? '...' : '');
          return `
            <div class="message-preview-item unread" onclick="openUserProfile('${msg.sender_username}')">
              ${avatar ? `<img src="${avatar}" alt="${msg.sender_username}" class="message-preview-avatar">` : 
                        `<div class="message-preview-avatar" style="background: #ff4f9f; display: flex; align-items: center; justify-content: center; color: #1e1b2e; font-weight: bold; font-size: 0.8rem;">${msg.sender_username.charAt(0).toUpperCase()}</div>`}
              <div class="message-preview-content">
                <div class="message-preview-sender">${msg.sender_username}<span class="message-preview-time">${time}</span></div>
                <div class="message-preview-text">${preview}</div>
              </div>
            </div>
          `;
        })).then(html => html.join(''));
      } catch (error) {
        console.error('Error in loadMessagePreviews:', error);
        messagePreviewList.innerHTML = '<div class="no-messages">Error loading messages</div>';
      }
    }

    async function updateMessageNotifications() {
      if (!window.supabaseClient || !currentUser || !currentUsername) return;

      try {
        const { count, error } = await supabase
          .from('direct_messages')
          .select('*', { count: 'exact', head: true })
          .eq('recipient_username', currentUsername)
          .eq('is_read', false);

        if (error) {
          console.error('Error counting messages:', error);
          return;
        }

        const unreadCount = count || 0;
        const messagesButton = document.getElementById('messages-button');
        const messageBadge = document.getElementById('message-badge');
        const taskbarMessages = document.getElementById('taskbar-messages');

        if (unreadCount > 0) {
          taskbarMessages.style.display = 'flex';
          messagesButton.classList.add('has-unread');
          messageBadge.style.display = 'flex';
          messageBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
        } else {
          messagesButton.classList.remove('has-unread');
          messageBadge.style.display = 'none';
          taskbarMessages.style.display = currentUser ? 'flex' : 'none';
        }
      } catch (error) {
        console.error('Error in updateMessageNotifications:', error);
      }
    }

    window.openUserProfile = function(username) {
      document.getElementById('message-preview-dropdown').classList.remove('show');
      markMessagesAsRead(username);
      window.location.href = `user.html?user=${username}`;
    };

    async function markMessagesAsRead(senderUsername) {
      if (!window.supabaseClient || !currentUsername) return;
      try {
        const { error } = await supabase
          .from('direct_messages')
          .update({ is_read: true })
          .eq('recipient_username', currentUsername)
          .eq('sender_username', senderUsername)
          .eq('is_read', false);
        if (!error) updateMessageNotifications();
      } catch (error) {
        console.error('Error in markMessagesAsRead:', error);
      }
    }

    async function getAvatarForUsername(username) {
      try {
        for (const table of ['game_submissions', 'game_videos', 'user_art']) {
          const { data } = await supabase
            .from(table)
            .select('avatar_url')
            .eq(table === 'game_submissions' ? 'github_user' : 'github_username', username)
            .limit(1);
          if (data?.[0]?.avatar_url) return data[0].avatar_url;
        }
        return null;
      } catch (error) {
        console.error('Error getting avatar:', error);
        return null;
      }
    }

    function initSearch() {
      const searchInput = document.getElementById('game-search-input');
      const suggestionsDropdown = document.getElementById('suggestions-dropdown');
      const searchButton = document.getElementById('search-button');
      let highlightedIndex = -1;

      if (!searchInput || !suggestionsDropdown || !searchButton) return;

      searchInput.addEventListener('input', () => {
        const query = searchInput.value.trim().toLowerCase();
        suggestionsDropdown.innerHTML = '';
        if (!query) {
          suggestionsDropdown.style.display = 'none';
          return;
        }

        const firstLetterMatches = gamePages.filter(g => g.title.toLowerCase().startsWith(query[0]));
        const results = firstLetterMatches.concat(
          gamePages.filter(g => g.title.toLowerCase().includes(query) && !g.title.toLowerCase().startsWith(query[0]))
        );

        if (results.length) {
          suggestionsDropdown.style.display = 'flex';
          results.forEach((game, index) => {
            const div = document.createElement('div');
            div.textContent = game.title;
            div.addEventListener('click', () => window.location.href = game.url);
            suggestionsDropdown.appendChild(div);
          });
        } else {
          suggestionsDropdown.style.display = 'none';
        }
        highlightedIndex = -1;
      });

      searchInput.addEventListener('keydown', (e) => {
        const suggestions = suggestionsDropdown.querySelectorAll('div');
        if (e.key === 'ArrowDown' && highlightedIndex < suggestions.length - 1) {
          highlightedIndex++;
          updateHighlightedItem(suggestions);
        } else if (e.key === 'ArrowUp' && highlightedIndex > 0) {
          highlightedIndex--;
          updateHighlightedItem(suggestions);
        } else if (e.key === 'Enter' && highlightedIndex >= 0) {
          suggestions[highlightedIndex].click();
        }
      });

      searchButton.addEventListener('click', () => {
        const query = searchInput.value.trim().toLowerCase();
        const game = gamePages.find(g => g.title.toLowerCase() === query);
        if (game) {
          window.location.href = game.url;
        } else {
          alert('No game found.');
        }
      });

      document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
          suggestionsDropdown.style.display = 'none';
          highlightedIndex = -1;
        }
      });

      function updateHighlightedItem(suggestions) {
        suggestions.forEach((item, index) => {
          item.style.background = index === highlightedIndex ? '#ff69b4' : 'transparent';
          item.style.color = index === highlightedIndex ? '#1e1b2e' : '#fefefe';
        });
      }
    }

    function addGlobalClickHandler() {
      document.addEventListener('click', (e) => {
        const dropdown = document.getElementById('user-dropdown');
        const userInfo = document.getElementById('user-info');
        const messageDropdown = document.getElementById('message-preview-dropdown');
        const messagesButton = document.getElementById('messages-button');
        if (dropdown && userInfo && !userInfo.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
        }
        if (messageDropdown && messagesButton && !messageDropdown.contains(e.target) && !messagesButton.contains(e.target)) {
          messageDropdown.classList.remove('show');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const gate = document.getElementById('access-choice-gate');
      const vipOption = document.getElementById('vip-option');
      const freeOption = document.getElementById('free-option');
      const vipProcess = document.getElementById('vip-process');
      const backBtn = document.getElementById('back-to-options');
      const accessMessage = document.getElementById('access-message');
      const githubLoginBtn = document.getElementById('github-login-btn');
      const loginStep = document.getElementById('login-step');
      const paymentStep = document.getElementById('payment-step');
      const loginStatus = document.getElementById('login-status');

      if (!localStorage.getItem('vipAccess') && !localStorage.getItem('freeAccess')) {
        gate.classList.add('show');
      }

      vipOption.addEventListener('click', () => {
        document.querySelector('.access-options').style.display = 'none';
        vipProcess.style.display = 'block';
        backBtn.style.display = 'inline-block';
      });

      freeOption.addEventListener('click', () => {
        localStorage.setItem('freeAccess', 'true');
        showAccessMessage('🎉 Free access granted!');
        setTimeout(() => {
          gate.classList.remove('show');
          renderVip();
        }, 1500);
      });

      backBtn.addEventListener('click', () => {
        vipProcess.style.display = 'none';
        backBtn.style.display = 'none';
        document.querySelector('.access-options').style.display = 'grid';
        accessMessage.style.display = 'none';
      });

      githubLoginBtn.addEventListener('click', () => {
        githubLoginBtn.disabled = true;
        githubLoginBtn.textContent = 'Connecting...';
        if (supabase) {
          supabase.auth.signInWithOAuth({ provider: 'github' });
        } else {
          showAccessMessage('Login system loading...', true);
          setTimeout(() => {
            if (supabase) {
              supabase.auth.signInWithOAuth({ provider: 'github' });
            } else {
              githubLoginBtn.disabled = false;
              githubLoginBtn.textContent = '🔑 Login with GitHub';
              showAccessMessage('Login system failed. Please refresh.', true);
            }
          }, 2000);
        }
      });

      window.addEventListener('vip-user-logged-in', (e) => {
        gateUser = e.detail;
        loginStep.classList.add('completed');
        githubLoginBtn.style.display = 'none';
        loginStatus.classList.add('show');
        setTimeout(() => {
          paymentStep.style.display = 'block';
          initVIPPayPal();
        }, 1000);
      });

      function showAccessMessage(text, isError = false) {
        accessMessage.textContent = text;
        accessMessage.className = isError ? 'error-message' : 'success-message';
        accessMessage.style.display = 'block';
      }

      window.initVIPPayPal = () => {
        if (!window.paypal) {
          showAccessMessage('PayPal not loaded. Please refresh.', true);
          return;
        }
        if (!gateUser) {
          showAccessMessage('Please login first.', true);
          return;
        }

        const container = document.getElementById('vip-paypal-container');
        if (container && !container.querySelector('.paypal-buttons')) {
          container.innerHTML = '';
          paypal.Buttons({
            style: { shape: 'rect', color: 'gold', layout: 'vertical', label: 'subscribe', height: 40 },
            createSubscription: (data, actions) => {
              accessMessage.style.display = 'none';
              return actions.subscription.create({ plan_id: 'P-20H197268N8973414NBIXE2I' });
            },
            onApprove: async (data) => {
              accessMessage.style.display = 'none';
              try {
                if (supabase && gateUser) {
                  const { error } = await supabase
                    .from('users')
                    .upsert({
                      id: gateUser.id,
                      is_vip: true,
                      vip_expires_at: null,
                      paypal_transaction_id: data.subscriptionID
                    });
                  if (error) console.error('Database update failed:', error);
                }
                localStorage.setItem('vipAccess', 'true');
                localStorage.setItem('vipSubscriptionId', data.subscriptionID);
                localStorage.setItem('vipActivatedAt', new Date().toISOString());
                showAccessMessage('🎉 VIP access activated!');
                setTimeout(() => {
                  gate.classList.remove('show');
                  renderVip();
                  renderNav();
                }, 1500);
              } catch (error) {
                console.error('Subscription error:', error);
                showAccessMessage('Subscription successful but error occurred. Please refresh.', true);
              }
            },
            onError: (err) => {
              console.error('PayPal error:', err);
              showAccessMessage('Payment error. Try again.', true);
            },
            onCancel: () => {
              showAccessMessage('Payment cancelled. Choose free access instead?', true);
            }
          }).render('#vip-paypal-container');
        }
      };

      setInterval(() => {
        if (document.hidden || !document.hasFocus()) {
          if (!localStorage.getItem('vipAccess') && !localStorage.getItem('freeAccess')) {
            gate.classList.add('show');
          }
        }
      }, 30000);
    });

    async function initializeApp() {
      if (isInitialized) return;
      isInitialized = true;
      try {
        renderNav();
        await renderAuth();
        await renderVip();
        initSearch();
        initMessageNotifications();
        addGlobalClickHandler();

        let authChangeTimeout;
        supabase.auth.onAuthStateChange(async () => {
          clearTimeout(authChangeTimeout);
          authChangeTimeout = setTimeout(async () => {
            if (!renderingInProgress) {
              await renderAuth();
              await renderVip();
              renderNav();
            }
          }, 100);
        });
      } catch (error) {
        console.error('Error initializing app:', error);
      }
    }

    window.renderVip = renderVip;
    window.renderAuth = renderAuth;
    window.renderNav = renderNav;

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrownDogGames</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&display=swap" rel="stylesheet" />
  <style>
    body {
      background-color: #1b1b2e;
      color: #fefefe;
      font-family: 'Rubik Mono One', sans-serif;
      margin: 0;
      padding: 10px;
      line-height: 1.5;
    }
    
    .feed-container {
      background-color: #2f1a39;
      border: 3px solid #ff4f9f;
      border-radius: 12px;
      max-width: 800px;
      margin: 0 auto 40px;
      padding: 25px 30px;
      box-shadow: 0 0 10px #ff4f9f88;
    }
    
    .feed-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .feed-header h2 {
      color: #ff4f9f;
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    
    .feed-header p {
      color: #e1c5f5;
      font-size: 0.9em;
      margin: 0;
    }
    
    .feed-table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1b1b2e;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .feed-table th {
      background-color: #ff4f9f;
      color: #1b1b2e;
      padding: 15px 12px;
      text-align: left;
      font-size: 0.9em;
      font-weight: 700;
    }
    
    .feed-table tbody tr {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .feed-table tbody tr:hover {
      background-color: #2a233a;
    }
    
    .feed-table tbody td {
      padding: 12px;
      vertical-align: middle;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #ff4f9f;
      margin-right: 10px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .username {
      color: #ff4f9f;
      font-weight: 700;
      font-size: 0.9em;
    }
    
    .post-type {
      background-color: #6c3d91;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.7em;
      font-weight: 700;
      display: inline-block;
    }
    
    .post-type.games { background-color: #ff4f9f; color: #1b1b2e; }
    .post-type.videos { background-color: #e33f8a; color: #fff; }
    .post-type.art { background-color: #6c3d91; color: #fff; }
    .post-type.music { background-color: #8a2be2; color: #fff; }
    .post-type.extras { background-color: #ffd700; color: #1b1b2e; }
    
    .post-title {
      color: #fefefe;
      font-size: 0.9em;
      line-height: 1.3;
    }
    
    .post-stats {
      display: flex;
      gap: 15px;
      font-size: 0.8em;
      color: #e1c5f5;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .timestamp {
      color: #999;
      font-size: 0.8em;
    }
    
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 0 auto 60px;
      max-width: 800px;
      flex-wrap: wrap;
    }
    
    .btn-play, .btn-video, .vip-leaderboard-button {
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.85em;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      border: none;
      color: #ffffff;
      background-color: #ff4f9f;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      height: 50px;
    }
    
    .btn-play {
      box-shadow: 0 4px 10px rgba(255,79,159,0.5);
    }
    
    .btn-play:hover, .btn-video:hover, .vip-leaderboard-button:hover {
      transform: translateY(-2px);
    }
    
    .btn-play:hover {
      background-color: #e33f8a;
      box-shadow: 0 6px 14px rgba(227,63,138,0.7);
    }
    
    .btn-video {
      background-color: #6c3d91;
      box-shadow: 0 4px 10px rgba(108,61,145,0.6);
    }
    
    .btn-video:hover {
      background-color: #572e75;
    }
    
    .vip-leaderboard-button {
      background-color: #ffd700;
      box-shadow: 0 4px 10px rgba(255,215,0,0.5);
    }
    
    .vip-leaderboard-button:hover {
      background-color: #ffcd00;
    }
    
    .featured-section {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    
    .featured-card {
      background-color: #2f1a39;
      border: 3px solid #ff4f9f;
      border-radius: 12px;
      padding: 20px;
      width: 280px;
      text-align: center;
      box-shadow: 0 0 8px #ff4f9f55;
      transition: transform 0.3s ease;
    }
    
    .featured-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 20px #ff4f9f99;
    }
    
    .featured-card img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px dashed #999;
    }
    
    .featured-card h3 {
      color: #ff4f9f;
      margin: 0 0 10px;
      font-size: 1.4em;
    }
    
    .featured-card p {
      font-size: 1em;
      margin-bottom: 20px;
      line-height: 1.3;
      color: #e1c5f5;
      min-height: 60px;
    }
    
    .featured-card .btn-play {
      padding: 10px 20px;
      font-size: 1em;
      box-shadow: 0 4px 12px rgba(255,79,159,0.7);
      min-height: 45px;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #ff4f9f33;
      border-radius: 50%;
      border-top-color: #ff4f9f;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-message {
      color: #ff8d8d;
      font-style: italic;
      text-align: center;
      padding: 2rem;
    }

    @media (max-width: 768px) {
      .btn-group {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      
      .btn-play, .btn-video, .vip-leaderboard-button {
        width: 90%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>

<div class="feed-container">
  <div class="feed-header">
    <h2>🔥 Latest Activity</h2>
    <p>See what the community is creating and sharing</p>
  </div>
  
  <table class="feed-table">
    <thead>
      <tr>
        <th>Creator</th>
        <th>Content</th>
        <th>Type</th>
        <th>Stats</th>
        <th>Posted</th>
      </tr>
    </thead>
    <tbody id="feed-table-body">
      <tr>
        <td colspan="5" style="text-align: center; padding: 2rem; opacity: 0.7;">
          <div class="loading-spinner"></div>
          Loading latest activity...
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="btn-group">
  <a href="VIP-games.html" class="btn-play">🎮 Explore VIP Games</a>
  <a href="VIP-dashboard.html" class="btn-video">👑 VIP dashboard</a>
  <a href="vip-leaderboard.html" class="vip-leaderboard-button">🏆 View VIP Leaderboard</a>
</div>

<div class="featured-section">
  <div class="featured-card">
    <img src="https://raw.githubusercontent.com/ItsMeDevX/BrownDogGames/main/LapdanceDashScreenshot.png" alt="Lapdance Dash Screenshot" />
    <h3>💃 Lapdance Dash</h3>
    <p>Dash through the strip club to the beat and rake in tips in this raunchy rhythm game!</p>
    <a href="Lapdance-Dash.html" target="_blank" rel="noopener noreferrer" class="btn-play">▶️ Play Game</a>
  </div>

  <div class="featured-card">
    <img src="https://raw.githubusercontent.com/ItsMeDevX/BrownDogGames/main/NakedCraftScreenshot.png" alt="Naked Craft Screenshot" />
    <h3>🪓 Naked Craft</h3>
    <p>Strip away survival conventions in this wild and nude block-building adventure!</p>
    <a href="naked-craft.html" target="_blank" rel="noopener noreferrer" class="btn-play">▶️ Play Game</a>
  </div>

  <div class="featured-card">
    <img src="https://raw.githubusercontent.com/ItsMeDevX/BrownDogGames/main/ButtBlasterArenaScreenshot.png" alt="Butt Blaster Arena Screenshot" />
    <h3>🍑 Butt Blaster Arena</h3>
    <p>Explosive chaos and cheeky physics in a multiplayer shooter like no other!</p>
    <a href="butt-blaster-arena.html" target="_blank" rel="noopener noreferrer" class="btn-play">▶️ Play Game</a>
  </div>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

  const supabase = createClient(
    'https://fwslmbzfukriibnkpzou.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3c2xtYnpmdWtyaWlibmtwem91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4NTcxMDcsImV4cCI6MjA2NDQzMzEwN30.juWK3T16_-LGHPii7xLp92Tt5TAZKN3IcZVn6nR8cBA'
  );

  // Get real likes from the same logic as leaderboard
  async function getRealLikes() {
    const consolidationMap = {
      'browndoggames': 'itsmedevx',
      'itsmedevX': 'itsmedevx',
    };

    // Get VIP extras mapping for old format
    const { data: vipExtras } = await supabase.from('vip_extras').select('id, creator_name');
    const extraCreatorMap = {};
    if (vipExtras) {
      vipExtras.forEach(extra => {
        if (extra.id && extra.creator_name) {
          extraCreatorMap[extra.id] = extra.creator_name;
        }
      });
    }

    // Get all view records
    const { data: allViews } = await supabase.from('vip_page_views').select('username, view_count, game_points');
    const usersLikesMap = {};

    if (allViews) {
      allViews.forEach(view => {
        const fullUsername = view.username;
        const viewCount = view.view_count || 0;
        const gamePoints = view.game_points || 0;
        
        if (!fullUsername) return;

        let finalUsername = fullUsername;
        let contentType = 'page';

        // Extract username and content type
        if (fullUsername.includes('_extra_')) {
          finalUsername = fullUsername.split('_extra_')[0];
          contentType = 'extras';
        } else if (fullUsername.includes('_video_')) {
          finalUsername = fullUsername.split('_video_')[0];
          contentType = 'videos';
        } else if (fullUsername.includes('_game_')) {
          finalUsername = fullUsername.split('_game_')[0];
          contentType = 'games';
        } else if (fullUsername.includes('_artwork_')) {
          finalUsername = fullUsername.split('_artwork_')[0];
          contentType = 'art';
        } else if (fullUsername.includes('_music_')) {
          finalUsername = fullUsername.split('_music_')[0];
          contentType = 'music';
        } else if (fullUsername.startsWith('extra_')) {
          const extraId = fullUsername.replace('extra_', '');
          const creatorName = extraCreatorMap[extraId];
          if (creatorName) {
            finalUsername = creatorName;
            contentType = 'extras';
          } else {
            return;
          }
        }

        // Apply consolidation
        finalUsername = consolidationMap[finalUsername] || consolidationMap[finalUsername.toLowerCase()] || finalUsername;

        // Initialize user if not exists
        if (!usersLikesMap[finalUsername]) {
          usersLikesMap[finalUsername] = {
            page: 0, videos: 0, games: 0, art: 0, music: 0, extras: 0, gamePoints: 0
          };
        }

        // Add to appropriate category
        usersLikesMap[finalUsername][contentType] += viewCount;
        usersLikesMap[finalUsername].gamePoints += gamePoints;
      });
    }

    return usersLikesMap;
  }

  // Utility functions
  function getRelativeTime(dateString) {
    const now = new Date();
    const date = new Date(dateString);
    const diffInMs = now - date;
    const diffInMinutes = Math.floor(diffInMs / (1000 * 60));
    const diffInHours = Math.floor(diffInMinutes / 60);
    const diffInDays = Math.floor(diffInHours / 24);

    if (diffInMinutes < 60) {
      return diffInMinutes <= 1 ? 'just now' : `${diffInMinutes}m ago`;
    } else if (diffInHours < 24) {
      return `${diffInHours}h ago`;
    } else if (diffInDays < 7) {
      return `${diffInDays}d ago`;
    } else {
      return date.toLocaleDateString();
    }
  }

  function getAvatarUrl(githubUser, avatarUrl) {
    if (avatarUrl && avatarUrl !== '' && avatarUrl !== null) {
      return avatarUrl;
    }
    
    const colors = ['ff4f9f', '6c3d91', 'e33f8a', 'ffd700', '8dffa1'];
    const colorIndex = (githubUser || 'Anonymous').length % colors.length;
    const color = colors[colorIndex];
    const initials = (githubUser || 'An').substring(0, 2).toUpperCase();
    
    return `https://via.placeholder.com/40/${color}/ffffff?text=${initials}`;
  }

  function getUserPageUrl(username, contentType) {
    const encodedUsername = encodeURIComponent(username);
    switch (contentType) {
      case 'games':
        return `user-games-page.html?user=${encodedUsername}`;
      case 'videos':
        return `user-videos-page.html?user=${encodedUsername}`;
      case 'art':
        return `user-art-page.html?user=${encodedUsername}`;
      case 'music':
        return `user-music-page.html?user=${encodedUsername}`;
      case 'extras':
        return `vip-extras.html?creator=${encodedUsername}`;
      default:
        return `user-games-page.html?user=${encodedUsername}`;
    }
  }

  // Load feed with real likes
  async function loadLatestFeed() {
    const feedTableBody = document.getElementById('feed-table-body');
    
    try {
      // Get real likes data
      const usersLikesMap = await getRealLikes();
      const allContent = [];

      // Helper to find user's real likes
      function getRealLikesForUser(username, contentType) {
        // Try exact match first
        if (usersLikesMap[username]) {
          return {
            likes: usersLikesMap[username][contentType] || 0,
            gamePoints: usersLikesMap[username].gamePoints || 0
          };
        }
        
        // Try case-insensitive match
        const foundUser = Object.keys(usersLikesMap).find(
          u => u.toLowerCase() === username.toLowerCase()
        );
        
        if (foundUser) {
          return {
            likes: usersLikesMap[foundUser][contentType] || 0,
            gamePoints: usersLikesMap[foundUser].gamePoints || 0
          };
        }
        
        return { likes: 0, gamePoints: 0 };
      }

      // Fetch content
      const { data: games } = await supabase
        .from('game_submissions')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(5);
      
      const { data: videos } = await supabase
        .from('game_videos')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(5);
      
      const { data: art } = await supabase
        .from('user_art')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(5);

      // Add games
      if (games) {
        games.forEach(game => {
          const realLikes = getRealLikesForUser(game.github_user, 'games');
          allContent.push({
            type: 'games',
            title: game.title || 'Untitled Game',
            creator: game.github_user || 'Anonymous',
            avatar_url: game.avatar_url,
            created_at: game.created_at,
            realLikes: realLikes.likes,
            gamePoints: realLikes.gamePoints
          });
        });
      }

      // Add videos
      if (videos) {
        videos.forEach(video => {
          const realLikes = getRealLikesForUser(video.github_username, 'videos');
          allContent.push({
            type: 'videos',
            title: video.title || 'Untitled Video',
            creator: video.github_username || 'Anonymous',
            avatar_url: video.avatar_url,
            created_at: video.created_at,
            realLikes: realLikes.likes,
            gamePoints: realLikes.gamePoints
          });
        });
      }

      // Add art
      if (art) {
        art.forEach(artwork => {
          const realLikes = getRealLikesForUser(artwork.github_username, 'art');
          allContent.push({
            type: 'art',
            title: artwork.title || 'Untitled Artwork',
            creator: artwork.github_username || 'Anonymous',
            avatar_url: artwork.avatar_url,
            created_at: artwork.created_at,
            realLikes: realLikes.likes,
            gamePoints: realLikes.gamePoints
          });
        });
      }

      // Sort by creation time
      allContent.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      const latestContent = allContent.slice(0, 10);

      if (latestContent.length === 0) {
        feedTableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 2rem; opacity: 0.7;">
              No content found. Be the first to submit something!
            </td>
          </tr>
        `;
        return;
      }

      const typeEmojis = {
        games: '🎮',
        videos: '📺', 
        art: '🎨',
        music: '🎵',
        extras: '⭐'
      };

      const feedHTML = latestContent.map(item => {
        const userPageUrl = getUserPageUrl(item.creator, item.type);
        const totalLikes = (item.realLikes || 0) + (item.gamePoints || 0);
        
        return `
          <tr onclick="window.location.href='${userPageUrl}'" style="cursor: pointer;">
            <td>
              <div class="user-info">
                <img src="${getAvatarUrl(item.creator, item.avatar_url)}" alt="${item.creator} Avatar" class="user-avatar" />
                <span class="username">${item.creator}</span>
              </div>
            </td>
            <td>
              <div class="post-title">${typeEmojis[item.type] || '📄'} ${item.title}</div>
            </td>
            <td>
              <span class="post-type ${item.type}">${item.type.toUpperCase()}</span>
            </td>
            <td>
              <div class="post-stats">
                <span class="stat-item">❤️ ${totalLikes > 1000 ? (totalLikes/1000).toFixed(1) + 'k' : totalLikes}</span>
                <span class="stat-item">🎯 ${item.gamePoints || 0}</span>
              </div>
            </td>
            <td>
              <span class="timestamp">${getRelativeTime(item.created_at)}</span>
            </td>
          </tr>
        `;
      }).join('');

      feedTableBody.innerHTML = feedHTML;

    } catch (error) {
      feedTableBody.innerHTML = `
        <tr>
          <td colspan="5" class="error-message">
            Error loading feed: ${error.message}
          </td>
        </tr>
      `;
    }
  }

  // Load feed when page loads
  document.addEventListener('DOMContentLoaded', loadLatestFeed);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberpunk Toast Popup</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik+Mono+One&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Rubik Mono One', sans-serif;
            background-color: #1e1b2e;
            color: #fefefe;
            min-height: 100vh;
            padding: 20px;
            background-image: linear-gradient(135deg, #2c1b33, #191425);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2a243b;
            border: 2px solid #ff69b4;
            color: #fefefe;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.4);
            max-width: 280px;
            min-width: 250px;
            z-index: 99999;
            font-family: 'Rubik Mono One', sans-serif;
            pointer-events: auto;
            transform: translateX(350px);
            animation: slideInRight 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s forwards;
        }

        @keyframes slideInRight {
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            to {
                transform: translateX(350px);
            }
        }

        .toast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
        }

        .toast h4 {
            margin: 0;
            font-size: 14px;
            font-weight: bold;
            color: #ff69b4;
            text-shadow: 0 2px 4px rgba(255, 105, 180, 0.3);
            pointer-events: none;
        }

        .toast p {
            margin: 0 0 12px 0;
            font-size: 11px;
            line-height: 1.4;
            color: #ffc0cb;
            pointer-events: none;
        }

        .toast p a {
            color: #ff69b4;
            text-decoration: underline;
        }

        .toast-buttons {
            display: flex;
            gap: 8px;
        }

        .toast-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-family: 'Rubik Mono One', sans-serif;
            flex: 1;
            pointer-events: auto;
            position: relative;
            z-index: 100000;
        }

        .primary-btn {
            background: #ff69b4;
            color: #1e1b2e;
        }

        .primary-btn:hover {
            background: #ff8edb;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(255, 105, 180, 0.3);
        }

        .primary-btn:active {
            transform: translateY(0);
            background: #ff1493;
        }

        .secondary-btn {
            background: #666;
            color: #fefefe;
            border: 1px solid #3b3750;
        }

        .secondary-btn:hover {
            background: #888;
            transform: translateY(-1px);
        }

        .secondary-btn:active {
            transform: translateY(0);
            background: #555;
        }

        .close-toast {
            background: none;
            border: none;
            color: #ff69b4;
            font-size: 16px;
            cursor: pointer;
            padding: 2px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Rubik Mono One', sans-serif;
            pointer-events: auto;
            z-index: 100001;
            position: relative;
        }

        .close-toast:hover {
            color: #ff8edb;
            background: rgba(255, 105, 180, 0.1);
            border-radius: 4px;
        }

        .close-toast:active {
            color: #ff1493;
        }

        .slide-out {
            animation: slideOutRight 0.4s ease-in forwards;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background: #ff69b4;
            width: 100%;
            animation: shrinkProgress 10s linear forwards;
            border-radius: 0 0 6px 6px;
            pointer-events: none;
        }

        @keyframes shrinkProgress {
            from { width: 100%; }
            to { width: 0%; }
        }

        .toast:hover {
            box-shadow: 0 0 25px rgba(255, 105, 180, 0.6);
        }

        @media (max-width: 600px) {
            .toast {
                bottom: 10px;
                left: 10px;
                right: 10px;
                min-width: auto;
                max-width: none;
                transform: translateY(100px);
                animation-name: slideInMobile;
            }

            @keyframes slideInMobile {
                to {
                    transform: translateY(0);
                }
            }

            @keyframes slideOutMobile {
                to {
                    transform: translateY(100px);
                }
            }

            .toast.slide-out {
                animation: slideOutMobile 0.4s ease-in forwards;
            }
        }
    </style>
</head>
<body>
    <div id="toast" class="toast">
        <div class="toast-progress"></div>
        <div class="toast-header">
            <h4>🚀 Launch!</h4>
            <button class="close-toast" onclick="closeToast()" title="Close">&times;</button>
        </div>
        <p>New features available! 
        <a href="https://otieu.com/4/9661607" target="_blank">Learn more</a></p>
        <div class="toast-buttons">
            <button class="toast-btn primary-btn" onclick="handleLaunchClick()">
                Join Now
            </button>
            <button class="toast-btn secondary-btn" onclick="closeToast()">
                Later
            </button>
        </div>
    </div>

    <script>
        function closeToast() {
            const toast = document.getElementById('toast');
            if (toast && !toast.classList.contains('slide-out')) {
                toast.classList.add('slide-out');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 400);
            }
        }

        function handleLaunchClick() {
            window.open('https://otieu.com/4/9661607', '_blank');
        }

        // Auto close after 10 seconds
        setTimeout(closeToast, 10000);

        // Close with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeToast();
            }
        });

        // Click event listeners as backup
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('close-toast')) {
                e.preventDefault();
                e.stopPropagation();
                closeToast();
            } else if (e.target.classList.contains('primary-btn')) {
                e.preventDefault();
                e.stopPropagation();
                handleLaunchClick();
            } else if (e.target.classList.contains('secondary-btn')) {
                e.preventDefault();
                e.stopPropagation();
                closeToast();
            }
        });
    </script>
</body>
</html>





































