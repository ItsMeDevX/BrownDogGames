<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auth Bar Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&display=swap" rel="stylesheet">
</head>
<body style="margin: 0; background-color: #1e1b2e; font-family: 'Rubik Mono One', sans-serif;">

  <!-- Auth Bar -->
  <div id="auth-bar" style="
    max-width: 320px;
    margin: 20px auto;
    background-color: #2a243b;
    border-radius: 12px;
    box-shadow: 0 0 12px #00000055;
    padding: 10px 16px;
    font-family: 'Rubik Mono One', sans-serif;
    color: #fefefe;
    min-height: 60px;
    position: relative;  /* For dropdown positioning */
    user-select: none;
  ">
    <!-- Content injected by JS -->
  </div>

  <style>
    /* Dropdown container */
    #user-dropdown {
      position: absolute;
      top: 70px; /* below the auth bar */
      right: 16px;
      background-color: #3b3750;
      border-radius: 8px;
      box-shadow: 0 4px 12px #00000077;
      min-width: 150px;
      display: none;
      flex-direction: column;
      z-index: 1000;
    }
    /* Dropdown buttons */
    #user-dropdown button {
      background: none;
      border: none;
      color: #fefefe;
      padding: 10px 16px;
      text-align: left;
      font-weight: bold;
      font-family: 'Rubik Mono One', sans-serif;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #user-dropdown button:hover {
      background-color: #ff69b4;
      color: #1e1b2e;
    }
    /* User info container (avatar + name) */
    #user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    #user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #ff69b4;
      object-fit: cover;
    }
    #user-info div {
      font-size: 0.9rem;
    }
  </style>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabase = createClient(
      'https://fwslmbzfukriibnkpzou.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3c2xtYnpmdWtyaWlibmtwem91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4NTcxMDcsImV4cCI6MjA2NDQzMzEwN30.juWK3T16_-LGHPii7xLp92Tt5TAZKN3IcZVn6nR8cBA'
    );

    const authBar = document.getElementById('auth-bar');

    function toggleDropdown(dropdown) {
      dropdown.style.display = (dropdown.style.display === 'flex') ? 'none' : 'flex';
    }

    async function renderAuthBar() {
      const { data: { session } } = await supabase.auth.getSession();
      authBar.innerHTML = '';

      // User Games button always visible
      const userGamesBtn = document.createElement('button');
      userGamesBtn.textContent = 'User Games';
      userGamesBtn.style.backgroundColor = '#ff69b4';
      userGamesBtn.style.color = '#1e1b2e';
      userGamesBtn.style.border = 'none';
      userGamesBtn.style.padding = '0.5rem 1rem';
      userGamesBtn.style.fontWeight = 'bold';
      userGamesBtn.style.fontSize = '0.9rem';
      userGamesBtn.style.borderRadius = '8px';
      userGamesBtn.style.cursor = 'pointer';
      userGamesBtn.style.transition = 'background-color 0.2s';
      userGamesBtn.addEventListener('mouseover', () => userGamesBtn.style.backgroundColor = '#ff8edb');
      userGamesBtn.addEventListener('mouseout', () => userGamesBtn.style.backgroundColor = '#ff69b4');
      userGamesBtn.addEventListener('click', () => {
        window.location.href = 'user-games.html';
      });
      authBar.appendChild(userGamesBtn);

      if (session?.user) {
        const { user_metadata } = session.user;
        const name = user_metadata.full_name || 'GitHub User';
        const avatar = user_metadata.avatar_url || '';

        // User info container (avatar + name)
        const userInfo = document.createElement('div');
        userInfo.id = 'user-info';

        if (avatar) {
          const img = document.createElement('img');
          img.src = avatar;
          img.alt = name;
          userInfo.appendChild(img);
        }

        const nameDiv = document.createElement('div');
        nameDiv.innerHTML = `<strong>${name}</strong>`;
        userInfo.appendChild(nameDiv);

        authBar.appendChild(userInfo);

        // Create dropdown container
        const dropdown = document.createElement('div');
        dropdown.id = 'user-dropdown';
        dropdown.style.display = 'none';
        dropdown.style.flexDirection = 'column';

        // Dropdown buttons
        const myPageBtn = document.createElement('button');
        myPageBtn.textContent = 'My Page';
        myPageBtn.onclick = () => {
          dropdown.style.display = 'none';
          window.location.href = 'user.html';
        };

        const dashboardBtn = document.createElement('button');
        dashboardBtn.textContent = 'Dashboard';
        dashboardBtn.onclick = () => {
          dropdown.style.display = 'none';
          window.location.href = 'dashboard.html';
        };

        const logoutBtn = document.createElement('button');
        logoutBtn.textContent = 'Logout';
        logoutBtn.onclick = async () => {
          await supabase.auth.signOut();
          window.location.reload();
        };

        dropdown.appendChild(myPageBtn);
        dropdown.appendChild(dashboardBtn);
        dropdown.appendChild(logoutBtn);

        authBar.appendChild(dropdown);

        userInfo.addEventListener('click', () => toggleDropdown(dropdown));

        // Close dropdown on outside click
        document.addEventListener('click', (e) => {
          if (!authBar.contains(e.target)) {
            dropdown.style.display = 'none';
          }
        });

      } else {
        // Not logged in: show login button
        const loginBtn = document.createElement('button');
        loginBtn.textContent = 'Login with GitHub';
        loginBtn.style.backgroundColor = '#ff69b4';
        loginBtn.style.color = '#1e1b2e';
        loginBtn.style.border = 'none';
        loginBtn.style.padding = '0.5rem 1rem';
        loginBtn.style.fontWeight = 'bold';
        loginBtn.style.fontSize = '0.9rem';
        loginBtn.style.borderRadius = '8px';
        loginBtn.style.cursor = 'pointer';
        loginBtn.style.transition = 'background-color 0.2s';
        loginBtn.addEventListener('mouseover', () => loginBtn.style.backgroundColor = '#ff8edb');
        loginBtn.addEventListener('mouseout', () => loginBtn.style.backgroundColor = '#ff69b4');
        loginBtn.addEventListener('click', async () => {
          await supabase.auth.signInWithOAuth({
            provider: 'github',
            options: { redirectTo: window.location.href }
          });
        });
        authBar.appendChild(loginBtn);
      }
    }

    renderAuthBar();
  </script>

</body>
</html>
